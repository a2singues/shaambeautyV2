<head>
	<meta name="viewport" content="width=device-width, initial-scale=1">

	<style>
		table, th, td {
			border: 1px solid #ddd;
		}
		.modal-backdrop {
			display: none;
		}
	</style>
<!--
	<link rel="stylesheet" href=https://cdn.jsdelivr.net/npm/bootstrap@4.5.3/dist/css/bootstrap.min.css>
	-->

</head>

<div class="container" style="background: #ccc; padding:0; margin:0;">
	<div style="width: 40%; padding: 5px; ">
		<img class="img-fluid" src="/img/shaambeauty-prospect.jpg" alt="SHAA'M Beauty"></img>
	</div>

	<div class="bg-white text-dark border rounded-sm p-4 mb-3"
		style="position:absolute;width: 58%; left:40%; top:32%; padding:0; margin:0;">
		{{#if bookingMsg}}
			<h5 style="color:#008800; margin-left:20%; margin-top:0.2%; margin-bottom:1%;">{{bookingMsg}}</h5>
		{{/if}}

		<h5 style="text-align: center; font-weight:bold; color:#0000AA">Vos rendez-vous à SHAA'M Beauty (par le {{customerPhone}})</h5>
		<div class="row" style="overflow-y: auto;">
			<div class="col" style="height:320px;">
				<table class="table table-striped" id="mybookings">
					<thead>
						<tr style="color:#fff; background: slategray;">
							<th>N°</th>
							<th>Date de rdv</th>
							<th>Heure de rdv</th>
							<th>Modif.</th>
							<th>Suppr.</th>
						</tr>
					</thead>
					<tbody>
						{{#each custbookings}}
						<tr>
							<td>{{this.bookingcount}}</td>
							<td>{{this.date}}</td>
							<td>{{this.time}}</td>
							<td>
								<a href="" data-toggle="modal" data-target="#myEditModal"><i class="fas fa-edit" aria-hidden="true"></i></a>
							</td>
							<td>
								<a href="" data-toggle="modal" data-target="#myDeleteModal"><i class="fa fa-trash" aria-hidden="true" style="color:red;"></i></a>
							</td>
						</tr>

						<!-- Modal edit -->
						<div class="modal" id="myEditModal">
							<div style="position:relative; left:32%; top:41%; width: 60%;">
								<div>
									<!-- Modal content-->
									<div class="container col-lg-4 col-md-6 col-sm-12 text-center position"
										style="background-color:palegoldenrod; padding:5px;">
										<h4 style="color: #0000AA; margin:0; padding:0;" class="text-center">Modification de réservation</h4><br>
										<form class="editForm" action="/updateBooking" method="POST">
											<input type="hidden" name="userphone" value="{{this.phone}}" />
											<input type="hidden" name="username" value={{user.name}} />
											<input type="hidden" id="bookingnum" name="bookingid" value="{{this.bookingcount}}" />
											<label>Date souhaitée de rendez-vous au format JJ/MM/AAAA</label>
											<div class="form-group" style="margin:0; padding:0;">
												<div class='input-group date' id='prefereddate'>
													<input type='date' name="bookingdate" id="bookingdate" class="form-control"	pattern="^\d{2}/\d{2}/\d{4}$"  placeholder="dd/MM/yyyy" min="01/01/1997" max="31/12/2030"
														value="{{this.fdate}}" required />
												</div>
											</div>

											<label style="margin-top:10px;">Heure souhaitée de rendez-vous au format HH:MM:SS</label>
											<div class="form-group" style="margin:0; padding:0;">
												<div class='input-group date' id='prefredtime'>
													<input type='time' name="bookingtime" id="bookingtime" class="form-control" min="00:00:00" max="23:59:59" pattern="^\d{2}:\d{2}:\d{2}$"
														placeholder="Heure souhaitée" value="{{this.time}}" required />
												</div>
											</div>

											<button type="submit" class="btn btn-info"	style="margin: 5px;">Je sauvegarde</button>
											<button type="button" class="btn btn-warning" data-dismiss="modal" style="margin: 5px;">Fermer</button>
										</form>
									</div>
								</div>
							</div>
						</div>

						<!-- Modal delete -->
						<div class="modal" id="myDeleteModal" role="dialog" >
							<div  style="position:relative; left:32%; top:41%; width:60%;">
							
							<!-- Modal content-->
								<div class="container col-lg-4 col-md-6 col-sm-12 text-center position" style="background-color: palegoldenrod; padding:5px;">
									<h4 style="color: #0000AA;" class="text-center">Suppression de réservation</h4><br>
									<!--form class="editForm" action="/deleteBooking" method="POST" -->
										<input type="hidden" id="userphone" name="userphone" value="{{this.phone}}" />
										<input type="hidden" name="username" value={{user.name}} />
										<input type="hidden" id="bookingnum" name="bookingid" value="{{this.bookingcount}}" />
										<span>Etes-vous sûr(e) de vouloir supprimer la réservation du <input id="bookdate" style="width:25%; border:0;" disabled/> à <input id="booktime" style="width:22%; border:0;" disabled/></span -->
										<!--span>Etes-vous sûr(e) de vouloir supprimer la réservation du {{this.date}} à {{this.time}}</span -->
										<!--input type='text' name="bookingdate" id="bookingdate" class="form-control"	/-->
										<!--input type="text" id="bookingdate" style="width:78px; border:0;" value="INIT" disabled/-->
										<hr>
										<!-- input type="submit" value="Je supprime" class="btn btn-info btn-lg" style="margin: 5px; color:#000;" -->
										<!-- a href="/deleteBooking/{{this.id}}" id="confirmDelete" class="btn btn-info btn-lg" style="margin: 5px; color:#000;">Je supprime</a -->
										<!--a href="/deleteBooking/{{this.bookingcount}}" id="confirmDelete" class="btn btn-info" style="margin: 5px; color:#000;" data-dismiss="modal">Je supprime</a -->
											<!--button type="button" class="btn btn-warning" style="margin: 5px; color:#000;" data-dismiss="modal">Annuler</button -->
										<!--button type="submit" class="btn btn-info"	style="margin: 5px;">Je supprime</button -->
	                               		<a href="" id="confirmDelete" class="btn btn-info" style="margin: 5px; ">Je supprime</a>
										<button type="button" class="btn btn-warning" style="margin: 5px; color:#000;" data-dismiss="modal">Annuler</button>
									<!--/form -->
								</div>      
							</div>
						</div>

						{{/each}}

					</tbody>
				</table>
			</div>
		</div>
	</div>
</div>

<!--
<script src=https://code.jquery.com/jquery-3.5.1.min.js></script>
-->

<!--
<script src=https://cdn.jsdelivr.net/npm/bootstrap@4.5.3/dist/js/bootstrap.bundle.min.js></script>
-->

<script>

	/*
	$(document).ready(function() {
	console.log("&& READY!!!");

		$('#mybookings .fa-edit').on('click', function(event) {
			event.preventDefault();
			
			var $row = $(this).closest("tr").find("td");

			console.log("&& Booking ID="+JSON.stringify($row[0].textContent));
			$('#bookingnum').val($row[0].textContent);
			console.log("&& Booking Date="+JSON.stringify($row[1].textContent));
			let bDateArr = $row[1].textContent.split('/');
			$('#bookingdate').val(bDateArr[2]+'-'+bDateArr[1]+'-'+bDateArr[0]);
			console.log("&& Booking Time="+JSON.stringify($row[2].textContent));
			$('#bookingtime').val($row[2].textContent);

			console.log("================== NUM="+$('#bookingnum').val());

			var href = $(this).attr('href');
			var text = $(this).text();
		});

		/*--- Deleting booking ----*
		$('#mybookings .fa-trash').on('click', function(event) {
			console.log("@@ CONFIRM SUPPR ...");
			event.preventDefault();
			
			var $row = $(this).closest("tr").find("td");

			console.log("&& Booking ID="+JSON.stringify($row[0].textContent));
			$('#bookingnum').val($row[0].textContent);
			console.log("&& Booking Date="+JSON.stringify($row[1].textContent));
			$('#bookdate').val($row[1].textContent);
			console.log("&& Booking Time="+JSON.stringify($row[2].textContent));
			$('#booktime').val($row[2].textContent);

			console.log("================== NUM="+$('#bookingnum').val());
			console.log("================== PHONE="+$('#userphone').val());

			console.log("## THIS="+JSON.stringify($(this)));

			var href = $(this).attr('href');
			var text = $(this).text();
			console.log("## HREF-init="+href);
			console.log("## TEXT="+text);
			
			console.log("----------------- NUM="+$('#bookingnum').val());
			$('#bookdate').val($row[1].textContent);
			console.log("----------------- bookdate="+$('#bookdate').val());

			$("a#confirmDelete").attr("href", "/deleteBooking/"+$('#bookingnum').val()+"/"+$('#userphone').val());
			
			//$(this).attr("href", "/deleteBooking/"+$('#bookingnum').val())
			var newurl = $("a#confirmDelete").attr("href");
			console.log("## HREF-upd="+newurl);
			//$(this).click();

		});
	});
*/

	/*
	$(document).ready(function() {
	console.log("&& READY!!!");
		$('#mybookings .fa-edit').on('click', function(event) {
			event.preventDefault();
			
			var $row = $(this).closest("tr").find("td");

			console.log("&& Booking ID="+JSON.stringify($row[0].textContent));
			$('#bookingnum').val($row[0].textContent);
			console.log("&& Booking Date="+JSON.stringify($row[1].textContent));
			$('#bookingdate').val($row[1].textContent);
			console.log("&& Booking Time="+JSON.stringify($row[2].textContent));
			$('#bookingtime').val($row[2].textContent);

			console.log("================== NUM="+$('#bookingnum').val());

			var href = $(this).attr('href');
			var text = $(this).text();

		});

		$('#mybookings .fa-trash').on('click', function(event) {
			console.log("@@ CONFIRM SUPPR ...");
			event.preventDefault();
			
			var $row = $(this).closest("tr").find("td");

			console.log("&& Booking ID="+JSON.stringify($row[0].textContent));
			$('#bookingnum').val($row[0].textContent);
			console.log("&& Booking Date="+JSON.stringify($row[1].textContent));
			$('#bookdate').val($row[1].textContent);
			console.log("&& Booking Time="+JSON.stringify($row[2].textContent));
			$('#booktime').val($row[2].textContent);

			console.log("================== NUM="+$('#bookingnum').val());

			console.log("## THIS="+JSON.stringify($(this)));

			var href = $(this).attr('href');
			var text = $(this).text();
			console.log("## HREF-init="+href);
			console.log("## TEXT="+text);
			
			$("a#confirmDelete").attr("href", "/deleteBooking/"+$('#bookingnum').val());
			
			//$(this).attr("href", "/deleteBooking/"+$('#bookingnum').val())
			var newurl = $("a#confirmDelete").attr("href");
			console.log("## HREF-upd="+newurl);
			//$(this).click();

		});

		$('.table .delBtn').on('click', function(event) {
			event.preventDefault();
			var href = $(this).attr('href');
			$('#myModal #delRef').attr('href', href);
			$('#myModal').modal();
		});

		$('#buttonCancel').on('click', function(event) {
			console.log("@@ CANCEL clicked !");
		}

	});
*/

</script>



